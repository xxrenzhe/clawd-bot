---
/**
 * Inline Article CTA Component
 *
 * A native-looking CTA that can be inserted within article content.
 * Designed to blend with the article while still converting.
 */
import { normalizeHostingReferralUrl } from '../../lib/hostingReferral';

interface Props {
  variant?: 'tip' | 'callout' | 'banner';
}

const { variant = 'callout' } = Astro.props;

const referralUrl = normalizeHostingReferralUrl(import.meta.env.HOSTING_REFERRAL_URL);
const trackingId = import.meta.env.HOSTING_REFERRAL_TRACKING_ID || 'clawdbot';

function buildUrl() {
  const url = new URL(referralUrl);
  url.searchParams.set('utm_source', 'clawd-bot.app');
  url.searchParams.set('utm_medium', 'referral');
  url.searchParams.set('utm_campaign', trackingId);
  url.searchParams.set('utm_content', `article-inline-${variant}`);
  return url.toString();
}

const styles = {
  tip: {
    container: 'border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-950/50 pl-4 py-3',
    icon: 'text-blue-500',
    title: 'text-blue-900 dark:text-blue-200',
    text: 'text-blue-700 dark:text-blue-300',
    button: 'text-blue-700 hover:text-blue-800 dark:text-blue-400',
  },
  callout: {
    container: 'rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-teal-50 dark:border-blue-800 dark:from-slate-950/50 dark:to-teal-900/60 p-6',
    icon: 'text-blue-600',
    title: 'text-gray-900 dark:text-gray-100',
    text: 'text-gray-700 dark:text-gray-300',
    button: 'bg-blue-600 text-white hover:bg-blue-700',
  },
  banner: {
    container: 'rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white',
    icon: 'text-blue-100',
    title: 'text-white',
    text: 'text-blue-100',
    button: 'bg-white text-blue-700 hover:bg-gray-100',
  },
};

const style = styles[variant];
---

<aside class={`not-prose my-8 ${style.container}`} role="complementary">
  <div class="flex items-start gap-4">
    <div class={`flex-shrink-0 ${style.icon}`}>
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
      </svg>
    </div>
    <div class="flex-1">
      <h4 class={`mb-1 font-bold ${style.title}`}>
        {variant === 'tip' ? 'Pro Tip' : 'Want Openclaw running 24/7?'}
      </h4>
      <p class={`mb-3 text-sm ${style.text}`}>
        {variant === 'tip'
          ? 'For the best experience, consider hosting Openclaw (Moltbot/Clawdbot) on a VPS so it never goes offline.'
          : 'Deploy Openclaw (Moltbot/Clawdbot) to a VPS and never worry about downtime. Get 30% off your first month with our recommended hosting partner.'}
      </p>
      {variant === 'tip' ? (
        <a
          href={buildUrl()}
          target="_blank"
          rel="noopener sponsored"
          class={`inline-flex items-center gap-1 text-sm font-medium ${style.button}`}
          data-analytics-event="hosting-cta-click"
          data-analytics-context="article-inline-tip"
        >
          Learn more about VPS hosting â†’
        </a>
      ) : (
        <a
          href={buildUrl()}
          target="_blank"
          rel="noopener sponsored"
          class={`inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-semibold transition-colors ${style.button}`}
          data-analytics-event="hosting-cta-click"
          data-analytics-context={`article-inline-${variant}`}
        >
          Get 30% Off Hosting
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
          </svg>
        </a>
      )}
    </div>
  </div>
</aside>
