---
interface Props {
  title: string;
  description: string;
  image: string;
  imageAlt?: string;
  publishedTime: Date;
  modifiedTime?: Date;
  author?: string;
  authorUrl?: string;
  keywords?: string[];
  category?: string;
  readingTime?: number;
  wordCount?: number;
  articleType?: 'Article' | 'TechArticle' | 'HowTo' | 'FAQPage' | 'NewsArticle';
}

const {
  title,
  description,
  image,
  imageAlt,
  publishedTime,
  modifiedTime,
  author = 'Moltbot (Clawdbot) Team',
  authorUrl,
  keywords = [],
  category,
  readingTime,
  wordCount,
  articleType = 'TechArticle',
} = Astro.props;

const baseKeywords = ['Moltbot', 'Clawdbot'];
const mergedKeywords: string[] = [];
const seenKeywords = new Set<string>();
for (const keyword of [...baseKeywords, ...keywords]) {
  const normalized = keyword.trim().toLowerCase();
  if (!normalized || seenKeywords.has(normalized)) {
    continue;
  }
  seenKeywords.add(normalized);
  mergedKeywords.push(keyword);
}

const imageUrl = new URL(image, Astro.site).href;
const articleUrl = Astro.url.href.replace(/\/$/, '');
const siteUrl = Astro.site?.href || 'https://clawd-bot.app';

const schema = {
  '@context': 'https://schema.org',
  '@type': articleType,
  headline: title,
  name: title,
  description: description,
  image: {
    '@type': 'ImageObject',
    url: imageUrl,
    width: 1200,
    height: 630,
    ...(imageAlt && { caption: imageAlt }),
  },
  datePublished: publishedTime.toISOString(),
  dateModified: (modifiedTime || publishedTime).toISOString(),
  author: {
    '@type': 'Person',
    name: author,
    ...(authorUrl && { url: authorUrl }),
  },
  publisher: {
    '@type': 'Organization',
    name: 'Moltbot',
    alternateName: 'Clawdbot',
    url: siteUrl,
    logo: {
      '@type': 'ImageObject',
      url: new URL('/logo.jpg', Astro.site).href,
      width: 512,
      height: 512,
    },
  },
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': articleUrl,
  },
  ...(mergedKeywords.length > 0 && { keywords: mergedKeywords.join(', ') }),
  ...(category && { articleSection: category }),
  ...(readingTime && { timeRequired: `PT${readingTime}M` }),
  ...(wordCount && { wordCount }),
  inLanguage: 'en-US',
  isAccessibleForFree: true,
  copyrightYear: new Date().getFullYear(),
  copyrightHolder: {
    '@type': 'Organization',
    name: 'Moltbot',
    alternateName: 'Clawdbot',
  },
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
