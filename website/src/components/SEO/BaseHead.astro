---
interface Props {
  title: string;
  description: string;
  keywords?: string[];
  image?: string;
  imageAlt?: string;
  article?: boolean;
  publishedTime?: Date;
  modifiedTime?: Date;
  author?: string;
  canonicalURL?: string;
  noindex?: boolean;
  articleType?: 'Article' | 'TechArticle' | 'HowTo' | 'FAQPage' | 'NewsArticle';
  readingTime?: number;
  category?: string;
}

const {
  title,
  description,
  keywords = [],
  image = '/images/og-default.jpg',
  imageAlt,
  article = false,
  publishedTime,
  modifiedTime,
  author,
  canonicalURL = Astro.url.href,
  noindex = false,
  articleType = 'TechArticle',
  readingTime,
  category,
} = Astro.props;

const siteTitle = 'Moltbot (Clawdbot) - Your Open Source AI Assistant';
const fullTitle = title === siteTitle ? title : `${title} | ${siteTitle}`;
const imageUrl = new URL(image, Astro.site).href;
const siteName = 'Moltbot (Clawdbot)';

const baseKeywords = ['Moltbot', 'Clawdbot'];
const mergedKeywords: string[] = [];
const seenKeywords = new Set<string>();
for (const keyword of [...baseKeywords, ...keywords]) {
  const normalized = keyword.trim().toLowerCase();
  if (!normalized || seenKeywords.has(normalized)) {
    continue;
  }
  seenKeywords.add(normalized);
  mergedKeywords.push(keyword);
}
const fontStylesheetUrl =
  'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap';

// Clean canonical URL (remove trailing slashes for consistency)
const cleanCanonicalURL = canonicalURL.replace(/\/$/, '');
---

<!-- Primary Meta Tags -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="generator" content={Astro.generator} />

<!-- Title -->
<title>{fullTitle}</title>
<meta name="title" content={fullTitle} />
<meta name="description" content={description} />
{mergedKeywords.length > 0 && <meta name="keywords" content={mergedKeywords.join(', ')} />}

<!-- Canonical URL -->
<link rel="canonical" href={cleanCanonicalURL} />

<!-- Robots -->
<meta name="robots" content={noindex ? 'noindex, nofollow' : 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1'} />
<meta name="googlebot" content={noindex ? 'noindex, nofollow' : 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1'} />
<meta name="bingbot" content={noindex ? 'noindex, nofollow' : 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1'} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={article ? 'article' : 'website'} />
<meta property="og:url" content={cleanCanonicalURL} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={imageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={imageAlt || title} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content="en_US" />
{article && publishedTime && <meta property="article:published_time" content={publishedTime.toISOString()} />}
{article && modifiedTime && <meta property="article:modified_time" content={modifiedTime.toISOString()} />}
{article && author && <meta property="article:author" content={author} />}
{article && category && <meta property="article:section" content={category} />}
{article && mergedKeywords.length > 0 && mergedKeywords.map(keyword => <meta property="article:tag" content={keyword} />)}
{article && readingTime && <meta property="article:reading_time" content={String(readingTime)} />}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={cleanCanonicalURL} />
<meta name="twitter:title" content={fullTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={imageUrl} />
<meta name="twitter:image:alt" content={imageAlt || title} />
{article && <meta name="twitter:label1" content="Reading time" />}
{article && readingTime && <meta name="twitter:data1" content={`${readingTime} min read`} />}
{article && category && <meta name="twitter:label2" content="Category" />}
{article && category && <meta name="twitter:data2" content={category} />}

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<link rel="shortcut icon" href="/favicon.ico" />

<!-- Additional SEO -->
<meta name="language" content="English" />
<meta name="revisit-after" content="7 days" />
<meta name="author" content={author || 'Moltbot (Clawdbot) Team'} />
<meta name="publisher" content="Moltbot (Clawdbot)" />
<meta name="application-name" content="Moltbot (Clawdbot)" />
<meta name="apple-mobile-web-app-title" content="Moltbot (Clawdbot)" />
<meta name="copyright" content="Â© 2026 Moltbot (Clawdbot). All rights reserved." />
<meta name="rating" content="General" />
<meta name="distribution" content="Global" />
<meta name="coverage" content="Worldwide" />
<meta name="target" content="all" />
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="format-detection" content="telephone=no" />

<!-- Geographic Tags -->
<meta name="geo.region" content="US" />
<meta name="geo.placename" content="United States" />

<!-- Theme Color -->
<meta name="theme-color" content="#0284C7" media="(prefers-color-scheme: light)" />
<meta name="theme-color" content="#0EA5E9" media="(prefers-color-scheme: dark)" />
<meta name="msapplication-TileColor" content="#0284C7" />
<meta name="msapplication-config" content="/browserconfig.xml" />

<!-- Preconnect to external domains -->
<link rel="dns-prefetch" href="https://plausible.io" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preload" as="style" href={fontStylesheetUrl} />
<link rel="stylesheet" href={fontStylesheetUrl} media="print" onload="this.media='all'" />
<noscript>
  <link rel="stylesheet" href={fontStylesheetUrl} />
</noscript>

<!-- Alternate Languages (for future internationalization) -->
<link rel="alternate" hreflang="en" href={cleanCanonicalURL} />
<link rel="alternate" hreflang="x-default" href={cleanCanonicalURL} />

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Moltbot (Clawdbot) Articles" href="/rss.xml" />
