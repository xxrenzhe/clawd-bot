---
import BaseLayout from './BaseLayout.astro';
import ArticleSchema from '../components/SEO/ArticleSchema.astro';
import BreadcrumbSchema from '../components/SEO/BreadcrumbSchema.astro';
import RelatedArticles from '../components/Articles/RelatedArticles.astro';
import ArticleNavigation from '../components/Articles/ArticleNavigation.astro';
import InlineArticleCTA from '../components/CTA/InlineArticleCTA.astro';
import HostingCTAEnhanced from '../components/CTA/HostingCTAEnhanced.astro';
import NewsletterSignup from '../components/Email/NewsletterSignup.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'articles'>;
}

const { entry } = Astro.props;
const { title, description, keywords, image, imageAlt, pubDate, modifiedDate, author, category, readingTime, tags } = entry.data;

const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: 'Articles', url: '/articles' },
  { name: category, url: `/articles?category=${category}` },
  { name: title, url: Astro.url.pathname },
];
---

<BaseLayout
  title={title}
  description={description}
  keywords={keywords}
  image={image}
  article={true}
  publishedTime={pubDate}
  modifiedTime={modifiedDate}
  author={author}
>
  <ArticleSchema
    title={title}
    description={description}
    image={image}
    imageAlt={imageAlt}
    publishedTime={pubDate}
    modifiedTime={modifiedDate}
    author={author}
    keywords={keywords}
    category={category}
    readingTime={readingTime}
    articleType={category === 'Tutorial' ? 'HowTo' : 'TechArticle'}
  />
  <BreadcrumbSchema items={breadcrumbs} />

  <!-- Breadcrumb Navigation -->
  <nav class="mx-auto max-w-4xl px-4 pt-8 sm:px-6 lg:px-8" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400" itemscope itemtype="https://schema.org/BreadcrumbList">
      {breadcrumbs.map((crumb, index) => (
        <li class="flex items-center" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          {index > 0 && (
            <svg class="mr-2 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
          )}
          {index < breadcrumbs.length - 1 ? (
            <a href={crumb.url} class="hover:text-blue-600 dark:hover:text-blue-400" itemprop="item">
              <span itemprop="name">{crumb.name}</span>
            </a>
          ) : (
            <span class="font-medium text-gray-900 dark:text-white" itemprop="name">{crumb.name}</span>
          )}
          <meta itemprop="position" content={String(index + 1)} />
        </li>
      ))}
    </ol>
  </nav>

  <article class="mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8" itemscope itemtype="https://schema.org/Article">
    <!-- Article Header -->
    <header class="mb-8">
      <div class="mb-4 flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
        <a href={`/articles?category=${category}`} class="rounded-full bg-blue-100 px-3 py-1 font-medium text-blue-800 transition-colors hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800">
          {category}
        </a>
        <time datetime={pubDate.toISOString()} itemprop="datePublished">
          {pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
        </time>
        <span>{readingTime} min read</span>
      </div>

      <h1 class="mb-4 text-4xl font-bold leading-tight text-gray-900 dark:text-white md:text-5xl" itemprop="headline">
        {title}
      </h1>

      <p class="text-xl text-gray-600 dark:text-gray-400" itemprop="description">
        {description}
      </p>

      <div class="mt-6 flex items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person">
        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-600 text-white">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        <div>
          <div class="font-medium text-gray-900 dark:text-white" itemprop="name">{author}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Author</div>
        </div>
      </div>
    </header>

    <!-- Article Content -->
    <div class="prose prose-lg prose-blue max-w-none dark:prose-invert prose-headings:font-bold prose-headings:scroll-mt-20 prose-a:text-blue-600 hover:prose-a:text-blue-700 prose-a:no-underline hover:prose-a:underline prose-code:rounded prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:text-sm prose-code:before:content-[''] prose-code:after:content-[''] dark:prose-code:bg-gray-800 prose-img:rounded-lg" itemprop="articleBody">
      <slot />
    </div>

    <!-- Hosting CTA after article content -->
    <div class="my-12">
      <HostingCTAEnhanced context="article" variant="default" />
    </div>

    <!-- Newsletter Signup -->
    <div class="my-12">
      <NewsletterSignup
        variant="inline"
        context="article"
        leadMagnet="Get more Clawdbot tips in your inbox"
      />
    </div>

    <!-- Article Footer -->
    <footer class="mt-12 space-y-8 border-t border-gray-200 pt-8 dark:border-gray-800">
      <!-- Tags -->
      <div>
        <h3 class="mb-3 text-sm font-semibold uppercase tracking-wider text-gray-900 dark:text-white">Tags</h3>
        <div class="flex flex-wrap gap-2">
          {keywords?.map((keyword) => (
            <a href={`/articles?tag=${keyword}`} class="rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700" title={`Browse articles tagged with ${keyword}`}>
              #{keyword}
            </a>
          ))}
        </div>
      </div>

      <!-- Share Buttons -->
      <div>
        <h3 class="mb-3 text-sm font-semibold uppercase tracking-wider text-gray-900 dark:text-white">Share Article</h3>
        <div class="flex gap-3">
          <a href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(Astro.url.href)}`} target="_blank" rel="noopener" class="flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-600" aria-label="Share on Twitter" title="Share this article on Twitter">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path>
            </svg>
            Twitter
          </a>
          <a href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`} target="_blank" rel="noopener" class="flex items-center gap-2 rounded-lg bg-blue-700 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-800" aria-label="Share on LinkedIn" title="Share this article on LinkedIn">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
            </svg>
            LinkedIn
          </a>
        </div>
      </div>
    </footer>

    <!-- Article Navigation (Previous/Next) -->
    <ArticleNavigation currentSlug={entry.slug} category={category} />
  </article>

  <!-- Related Articles Section -->
  <div class="mx-auto max-w-4xl px-4 pb-12 sm:px-6 lg:px-8">
    <RelatedArticles
      currentSlug={entry.slug}
      category={category}
      keywords={keywords}
      maxArticles={3}
      title="You May Also Like"
    />
  </div>

  <!-- Back to Articles -->
  <div class="mx-auto max-w-4xl px-4 pb-12 text-center sm:px-6 lg:px-8">
    <a href="/articles" class="inline-flex items-center gap-2 text-blue-600 transition-colors hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300" title="Browse all Clawdbot articles and tutorials">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to All Articles
    </a>
  </div>
</BaseLayout>

<style is:global>
  /* Custom prose styles for better readability */
  .prose img {
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  .prose pre {
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  /* Smooth scroll for anchor links */
  html {
    scroll-behavior: smooth;
  }

  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
