---
import BaseHead from '../components/SEO/BaseHead.astro';
import Header from '../components/Layout/Header.astro';
import Footer from '../components/Layout/Footer.astro';
import Analytics from '../components/Analytics/Analytics.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  keywords?: string[];
  image?: string;
  article?: boolean;
  publishedTime?: Date;
  modifiedTime?: Date;
  author?: string;
  noindex?: boolean;
  category?: string;
}

const {
  title,
  description,
  keywords,
  image,
  article,
  publishedTime,
  modifiedTime,
  author,
  noindex,
  category,
} = Astro.props;
---

<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <BaseHead
      title={title}
      description={description}
      keywords={keywords}
      image={image}
      article={article}
      publishedTime={publishedTime}
      modifiedTime={modifiedTime}
      author={author}
      noindex={noindex}
      category={category}
    />

    <!-- Analytics -->
    <Analytics />

    <!-- Inline critical CSS for faster rendering -->
    <style is:inline>
      /* Critical CSS - Above the fold styles */
      body {
        margin: 0;
        font-family: "IBM Plex Sans", "Segoe UI", system-ui, sans-serif;
        background-color: #f6f3ee;
        color: #0f172a;
      }

      /* Prevent layout shift */
      .flex {
        display: flex;
      }

      .min-h-screen {
        min-height: 100vh;
      }

      .flex-col {
        flex-direction: column;
      }

      .flex-1 {
        flex: 1 1 0%;
      }
    </style>
  </head>
  <body class="flex min-h-screen flex-col antialiased">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-blue-600 focus:text-white">
      Skip to main content
    </a>

    <Header />

    <main id="main-content" class="flex-1" role="main">
      <slot />
    </main>

    <Footer />

    <!-- Back to top button -->
    <button
      id="back-to-top"
      class="fixed bottom-24 right-4 hidden rounded-full bg-blue-600 p-3 text-white shadow-float transition-all hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:bottom-8 sm:right-8"
      aria-label="Back to top"
    >
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
      </svg>
    </button>

    <script>
      // Back to top button functionality
      const backToTopButton = document.getElementById('back-to-top');

      if (backToTopButton) {
        let lastKnownScrollY = window.scrollY;
        let isTicking = false;
        let isVisible = false;

        const updateVisibility = () => {
          isTicking = false;
          const shouldShow = lastKnownScrollY > 300;
          if (shouldShow === isVisible) return;
          isVisible = shouldShow;
          backToTopButton.classList.toggle('hidden', !shouldShow);
        };

        const handleScroll = () => {
          lastKnownScrollY = window.scrollY;
          if (!isTicking) {
            isTicking = true;
            requestAnimationFrame(updateVisibility);
          }
        };

        updateVisibility();
        window.addEventListener('scroll', handleScroll, { passive: true });

        backToTopButton.addEventListener('click', () => {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      }
    </script>
  </body>
</html>
