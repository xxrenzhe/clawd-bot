---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ItemListSchema from '../../components/SEO/ItemListSchema.astro';
import BreadcrumbSchema from '../../components/SEO/BreadcrumbSchema.astro';
import { getCollection } from 'astro:content';

const allArticles = await getCollection('articles');
const sortedArticles = allArticles.sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

const categories = ['All', 'Tutorial', 'Guide', 'Comparison', 'Best Practices', 'News', 'Advanced'];

const baseUrl = Astro.site?.href?.replace(/\/$/, '') || 'https://clawd-bot.app';

const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: 'Articles', url: '/articles' },
];

const listItems = sortedArticles.map((article, index) => ({
  title: article.data.title,
  url: `${baseUrl}/articles/${article.slug}`,
  description: article.data.description,
  image: article.data.image ? `${baseUrl}${article.data.image}` : undefined,
  position: index + 1,
}));
---

<BaseLayout
  title="Clawdbot Articles & Tutorials | Guides, How-tos & Best Practices"
  description="Browse comprehensive guides, tutorials, and best practices for using Clawdbot. Learn how to set up, configure, and optimize your AI assistant for maximum productivity."
  keywords={['clawdbot tutorials', 'clawdbot guides', 'AI assistant setup', 'clawdbot documentation', 'clawdbot how to', 'discord bot tutorials']}
>
  <ItemListSchema
    name="Clawdbot Articles & Tutorials"
    description="Comprehensive collection of guides, tutorials, and best practices for Clawdbot AI assistant"
    items={listItems}
    itemType="TechArticle"
  />
  <BreadcrumbSchema items={breadcrumbs} />
  <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-12 text-center">
      <h1 class="mb-4 text-5xl font-bold text-gray-900 dark:text-white">
        Articles & Tutorials
      </h1>
      <p class="mx-auto max-w-2xl text-xl text-gray-600 dark:text-gray-400">
        Everything you need to know about Clawdbot, from setup to advanced usage.
      </p>
    </div>

    <!-- Category Filter -->
    <div class="mb-8 flex flex-wrap justify-center gap-3">
      {categories.map((category) => (
        <button
          class="category-filter rounded-full border-2 border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-all hover:border-blue-600 hover:text-blue-600 dark:border-gray-700 dark:text-gray-300 dark:hover:border-blue-400 dark:hover:text-blue-400"
          data-category={category}
        >
          {category}
        </button>
      ))}
    </div>

    <!-- Articles Grid -->
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {sortedArticles.map((article) => (
        <article
          class="article-card group rounded-lg border border-gray-200 bg-white shadow-sm transition-all hover:shadow-md dark:border-gray-800 dark:bg-gray-950"
          data-category={article.data.category}
        >
          <a href={`/articles/${article.slug}`} class="block">
            <div class="p-6">
              <div class="mb-3 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                <span class="rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                  {article.data.category}
                </span>
                <span>{article.data.readingTime} min read</span>
              </div>
              <h2 class="mb-2 text-xl font-bold text-gray-900 transition-colors group-hover:text-blue-600 dark:text-white dark:group-hover:text-blue-400">
                {article.data.title}
              </h2>
              <p class="mb-4 text-gray-600 dark:text-gray-400">
                {article.data.description}
              </p>
              <div class="flex items-center justify-between">
                <time
                  datetime={article.data.pubDate.toISOString()}
                  class="text-sm text-gray-500 dark:text-gray-500"
                >
                  {article.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                  })}
                </time>
                <div class="flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400">
                  Read more
                  <svg
                    class="h-4 w-4 transition-transform group-hover:translate-x-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 7l5 5m0 0l-5 5m5-5H6"
                    ></path>
                  </svg>
                </div>
              </div>
            </div>
          </a>
        </article>
      ))}
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="hidden py-20 text-center">
      <svg
        class="mx-auto mb-4 h-16 w-16 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        ></path>
      </svg>
      <p class="text-xl text-gray-600 dark:text-gray-400">
        No articles found in this category.
      </p>
    </div>
  </div>
</BaseLayout>

<script>
  const filterButtons = document.querySelectorAll('.category-filter');
  const articleCards = document.querySelectorAll('.article-card');
  const emptyState = document.getElementById('empty-state');

  filterButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const category = button.getAttribute('data-category');

      // Update active button
      filterButtons.forEach((btn) => {
        btn.classList.remove('border-blue-600', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
        btn.classList.add('border-gray-300', 'text-gray-700', 'dark:border-gray-700', 'dark:text-gray-300');
      });
      button.classList.remove('border-gray-300', 'text-gray-700', 'dark:border-gray-700', 'dark:text-gray-300');
      button.classList.add('border-blue-600', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');

      // Filter articles
      let visibleCount = 0;
      articleCards.forEach((card) => {
        const articleCategory = card.getAttribute('data-category');
        if (category === 'All' || articleCategory === category) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // Show/hide empty state
      if (visibleCount === 0) {
        emptyState?.classList.remove('hidden');
      } else {
        emptyState?.classList.add('hidden');
      }
    });
  });

  // Set "All" as active by default
  const allButton = document.querySelector('[data-category="All"]');
  if (allButton) {
    allButton.classList.remove('border-gray-300', 'text-gray-700', 'dark:border-gray-700', 'dark:text-gray-300');
    allButton.classList.add('border-blue-600', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
  }
</script>
